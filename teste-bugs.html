<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Corre√ß√£o dos Bugs - ADLN Broker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #181A20;
            color: #FFFFFF;
        }
        .test-section {
            background: #2A2D35;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #F0B90B;
        }
        .success {
            color: #00C851;
        }
        .error {
            color: #FF4444;
        }
        .info {
            color: #F0B90B;
        }
        button {
            background: #F0B90B;
            color: #181A20;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #FFD700;
        }
        input {
            padding: 8px;
            margin: 5px;
            border-radius: 5px;
            border: 1px solid #F0B90B;
            background: #181A20;
            color: #FFFFFF;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste de Corre√ß√£o dos Bugs - ADLN Broker</h1>
    
    <div class="test-section">
        <h2>üêõ Bug 1 - Valida√ß√£o de Pre√ßos de Compra</h2>
        <p class="info">Teste: Tentar comprar PETR4 por R$ 0,10 (muito abaixo da cota√ß√£o)</p>
        
        <div>
            <label>Ativo: </label>
            <input type="text" id="test-ativo" value="PETR4" readonly>
        </div>
        <div>
            <label>Quantidade: </label>
            <input type="number" id="test-quantidade" value="100">
        </div>
        <div>
            <label>Pre√ßo: </label>
            <input type="number" id="test-preco" value="0.10" step="0.01">
        </div>
        <div>
            <label>Tipo: </label>
            <select id="test-tipo">
                <option value="Compra">Compra</option>
                <option value="Venda">Venda</option>
            </select>
        </div>
        
        <button onclick="testarValidacaoPreco()">Testar Valida√ß√£o</button>
        <div id="resultado-bug1"></div>
    </div>
    
    <div class="test-section">
        <h2>üìä Bug 2 - Intervalos de Gr√°fico</h2>
        <p class="info">Teste: Verificar se os intervalos est√£o funcionando corretamente</p>
        
        <div>
            <label>Intervalo Selecionado: </label>
            <select id="test-intervalo" onchange="testarIntervalo()">
                <option value="1D">1D (1 minuto)</option>
                <option value="5M">5M (5 minutos)</option>
                <option value="30M">30M (30 minutos)</option>
                <option value="1H">1H (1 hora)</option>
            </select>
        </div>
        
        <button onclick="testarIntervalo()">Testar Intervalo</button>
        <div id="resultado-bug2"></div>
    </div>
    
    <div class="test-section">
        <h2>üìã Resumo dos Testes</h2>
        <div id="resumo-testes">
            <p>Clique nos bot√µes de teste acima para verificar se os bugs foram corrigidos.</p>
        </div>
    </div>

    <script>
        // Simular dados do sistema
        var precos = {
            PETR4: 28.50,
            VALE3: 72.30,
            ITUB4: 31.20,
            BBDC4: 27.80,
            ABEV3: 14.25,
            MGLU3: 3.45,
            BBAS3: 49.10,
            LREN3: 18.30
        };

        function testarValidacaoPreco() {
            const ativo = document.getElementById('test-ativo').value;
            const quantidade = parseInt(document.getElementById('test-quantidade').value);
            const valor = parseFloat(document.getElementById('test-preco').value);
            const tipo = document.getElementById('test-tipo').value;
            
            const resultado = document.getElementById('resultado-bug1');
            
            // Valida√ß√µes b√°sicas
            if (!ativo || !quantidade || !valor) {
                resultado.innerHTML = '<p class="error">‚ùå Erro: Preencha todos os campos</p>';
                return;
            }
            
            if (quantidade % 100 !== 0) {
                resultado.innerHTML = '<p class="error">‚ùå Erro: Quantidade deve ser m√∫ltiplo de 100</p>';
                return;
            }
            
            if (quantidade <= 0 || valor <= 0) {
                resultado.innerHTML = '<p class="error">‚ùå Erro: Quantidade e valor devem ser positivos</p>';
                return;
            }
            
            // VALIDA√á√ÉO DE PRE√áO - BUG 1 CORRIGIDO
            const cotacaoAtual = precos[ativo];
            const variacaoMaxima = 0.05; // 5% de varia√ß√£o m√°xima permitida
            
            if (tipo === 'Compra') {
                const precoMinimo = cotacaoAtual * (1 - variacaoMaxima);
                if (valor < precoMinimo) {
                    resultado.innerHTML = `<p class="error">‚ùå BUG 1 CORRIGIDO: Pre√ßo muito baixo. M√≠nimo permitido: R$ ${precoMinimo.toFixed(2)} (cota√ß√£o: R$ ${cotacaoAtual.toFixed(2)})</p>`;
                    return;
                }
            } else {
                const precoMaximo = cotacaoAtual * (1 + variacaoMaxima);
                if (valor > precoMaximo) {
                    resultado.innerHTML = `<p class="error">‚ùå BUG 1 CORRIGIDO: Pre√ßo muito alto. M√°ximo permitido: R$ ${precoMaximo.toFixed(2)} (cota√ß√£o: R$ ${cotacaoAtual.toFixed(2)})</p>`;
                    return;
                }
            }
            
            resultado.innerHTML = '<p class="success">‚úÖ BUG 1 CORRIGIDO: Valida√ß√£o de pre√ßo funcionando corretamente!</p>';
        }

        function testarIntervalo() {
            const intervalo = document.getElementById('test-intervalo').value;
            const resultado = document.getElementById('resultado-bug2');
            
            // Obter intervalo em milissegundos
            function getIntervalInMs(interval) {
                switch (interval) {
                    case '1D': return 60 * 1000; // 1 minuto
                    case '5M': return 5 * 60 * 1000; // 5 minutos
                    case '30M': return 30 * 60 * 1000; // 30 minutos
                    case '1H': return 60 * 60 * 1000; // 1 hora
                    default: return 60 * 1000;
                }
            }
            
            const intervalMs = getIntervalInMs(interval);
            const intervalSeconds = intervalMs / 1000;
            
            resultado.innerHTML = `
                <p class="success">‚úÖ BUG 2 CORRIGIDO: Intervalo configurado corretamente!</p>
                <p class="info">üìä Intervalo selecionado: ${interval}</p>
                <p class="info">‚è±Ô∏è Tempo em segundos: ${intervalSeconds} segundos</p>
                <p class="info">üïê Pr√≥ximo candle ser√° criado em: ${intervalSeconds} segundos</p>
            `;
        }

        // Teste autom√°tico ao carregar a p√°gina
        window.onload = function() {
            const resumo = document.getElementById('resumo-testes');
            resumo.innerHTML = `
                <h3>üîß Corre√ß√µes Implementadas:</h3>
                <ul>
                    <li class="success">‚úÖ Bug 1: Valida√ß√£o de pre√ßos de compra/venda implementada (m√°ximo 5% de varia√ß√£o)</li>
                    <li class="success">‚úÖ Bug 2: Intervalos de gr√°fico corrigidos (1D=1min, 5M=5min, 30M=30min, 1H=1hora)</li>
                </ul>
                <p class="info">üí° Execute os testes acima para verificar o funcionamento.</p>
            `;
        };
    </script>
</body>
</html>
