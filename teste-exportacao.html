<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Exporta√ß√£o - ADLN Broker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #181A20;
            color: #FFFFFF;
        }
        .test-section {
            background: #2A2D35;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #F0B90B;
        }
        .success {
            color: #00C851;
        }
        .error {
            color: #FF4444;
        }
        .info {
            color: #F0B90B;
        }
        button {
            background: #F0B90B;
            color: #181A20;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #FFD700;
        }
        .export-buttons {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .export-btn {
            background: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .export-btn:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste de Funcionalidade de Exporta√ß√£o - ADLN Broker</h1>
    
    <div class="test-section">
        <h2>üìä Funcionalidade de Exporta√ß√£o</h2>
        <p class="info">Este teste verifica se a funcionalidade de exporta√ß√£o est√° funcionando corretamente.</p>
        
        <div class="export-buttons">
            <button class="export-btn" onclick="testarExportacaoJSON()">Testar Exporta√ß√£o JSON</button>
            <button class="export-btn" onclick="testarExportacaoExcel()">Testar Exporta√ß√£o Excel</button>
        </div>
        
        <button onclick="verificarTransacoes()">Verificar Transa√ß√µes do Dia</button>
        <button onclick="simularTransacao()">Simular Transa√ß√£o de Teste</button>
        
        <div id="resultado-teste"></div>
    </div>
    
    <div class="test-section">
        <h2>üìã Pr√©-requisitos para Teste</h2>
        <ul>
            <li>‚úÖ Usu√°rio deve estar logado no sistema</li>
            <li>‚úÖ Deve haver transa√ß√µes no extrato do dia</li>
            <li>‚úÖ Fun√ß√£o exportarTransacoesDia() deve estar implementada</li>
            <li>‚úÖ Fun√ß√£o exportarExtratoExcel() deve estar implementada</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h2>üîÑ Como Testar no Dashboard</h2>
        <ol>
            <li>Acesse o dashboard do sistema</li>
            <li>Clique no menu hamb√∫rguer (‚ò∞) no canto superior direito</li>
            <li>Selecione "üìä Exportar Transa√ß√µes do Dia" para JSON</li>
            <li>Ou clique no bot√£o "Exportar transa√ß√µes do dia (XLSX)" para Excel</li>
            <li>Verifique se o arquivo √© baixado</li>
            <li>Abra o arquivo para verificar o conte√∫do</li>
        </ol>
    </div>

    <script>
        // Fun√ß√£o para testar a exporta√ß√£o JSON
        function testarExportacaoJSON() {
            const resultado = document.getElementById('resultado-teste');
            
            try {
                // Verificar se a fun√ß√£o existe
                if (typeof exportarTransacoesDia === 'function') {
                    resultado.innerHTML = '<span class="success">‚úÖ Fun√ß√£o exportarTransacoesDia() encontrada e funcionando!</span>';
                    resultado.innerHTML += '<br><span class="info">A funcionalidade est√° implementada e pronta para uso.</span>';
                    
                    // Executar a exporta√ß√£o
                    exportarTransacoesDia();
                } else {
                    resultado.innerHTML = '<span class="error">‚ùå Fun√ß√£o exportarTransacoesDia() n√£o encontrada!</span>';
                    resultado.innerHTML += '<br><span class="info">Verifique se o arquivo sistema.js foi atualizado corretamente.</span>';
                }
            } catch (error) {
                resultado.innerHTML = '<span class="error">‚ùå Erro ao testar funcionalidade: ' + error.message + '</span>';
            }
        }

        // Fun√ß√£o para testar a exporta√ß√£o Excel
        function testarExportacaoExcel() {
            const resultado = document.getElementById('resultado-teste');
            
            try {
                // Verificar se a fun√ß√£o existe
                if (typeof exportarExtratoExcel === 'function') {
                    resultado.innerHTML = '<span class="success">‚úÖ Fun√ß√£o exportarExtratoExcel() encontrada e funcionando!</span>';
                    resultado.innerHTML += '<br><span class="info">A funcionalidade est√° implementada e pronta para uso.</span>';
                    
                    // Executar a exporta√ß√£o
                    exportarExtratoExcel();
                } else {
                    resultado.innerHTML = '<span class="error">‚ùå Fun√ß√£o exportarExtratoExcel() n√£o encontrada!</span>';
                    resultado.innerHTML += '<br><span class="info">Verifique se o arquivo dashboard.html foi atualizado corretamente.</span>';
                }
            } catch (error) {
                resultado.innerHTML = '<span class="error">‚ùå Erro ao testar funcionalidade: ' + error.message + '</span>';
            }
        }

        // Fun√ß√£o para verificar transa√ß√µes do dia
        function verificarTransacoes() {
            const resultado = document.getElementById('resultado-teste');
            
            try {
                // Verificar se h√° usu√°rio logado
                const usuarioAtual = localStorage.getItem('adln_usuario_atual');
                if (!usuarioAtual) {
                    resultado.innerHTML = '<span class="error">‚ùå Nenhum usu√°rio logado!</span>';
                    resultado.innerHTML += '<br><span class="info">Fa√ßa login no sistema para testar a exporta√ß√£o.</span>';
                    return;
                }

                // Verificar extrato
                const extratoData = localStorage.getItem('adln_extrato_' + usuarioAtual);
                if (!extratoData) {
                    resultado.innerHTML = '<span class="error">‚ùå Nenhuma transa√ß√£o encontrada!</span>';
                    resultado.innerHTML += '<br><span class="info">Realize algumas opera√ß√µes de compra/venda para testar a exporta√ß√£o.</span>';
                    return;
                }

                const extrato = JSON.parse(extratoData);
                const hoje = new Date().toISOString().split('T')[0];

                // Filtrar transa√ß√µes do dia
                const transacoesHoje = extrato.filter(t => {
                    if (!t.data) return false;
                    const dataTransacao = new Date(t.data).toISOString().split('T')[0];
                    return dataTransacao === hoje;
                });

                resultado.innerHTML = '<span class="success">‚úÖ Usu√°rio logado: ' + usuarioAtual + '</span>';
                resultado.innerHTML += '<br><span class="info">Total de transa√ß√µes: ' + extrato.length + '</span>';
                resultado.innerHTML += '<br><span class="info">Transa√ß√µes hoje (' + hoje + '): ' + transacoesHoje.length + '</span>';

                if (transacoesHoje.length > 0) {
                    resultado.innerHTML += '<br><span class="success">‚úÖ Transa√ß√µes do dia encontradas! Pode testar a exporta√ß√£o.</span>';
                } else {
                    resultado.innerHTML += '<br><span class="error">‚ùå Nenhuma transa√ß√£o hoje. Use o bot√£o "Simular Transa√ß√£o" para criar dados de teste.</span>';
                }

            } catch (error) {
                resultado.innerHTML = '<span class="error">‚ùå Erro ao verificar transa√ß√µes: ' + error.message + '</span>';
            }
        }

        // Fun√ß√£o para simular transa√ß√£o de teste
        function simularTransacao() {
            const resultado = document.getElementById('resultado-teste');
            
            try {
                const usuarioAtual = localStorage.getItem('adln_usuario_atual');
                if (!usuarioAtual) {
                    resultado.innerHTML = '<span class="error">‚ùå Nenhum usu√°rio logado!</span>';
                    resultado.innerHTML += '<br><span class="info">Fa√ßa login no sistema primeiro.</span>';
                    return;
                }

                const transacaoTeste = {
                    tipo: 'Compra',
                    ativo: 'PETR4',
                    quantidade: 100,
                    valorTotal: '2850.00',
                    data: new Date().toISOString(),
                    status: 'Executada'
                };

                // Adicionar ao extrato
                const extratoData = localStorage.getItem('adln_extrato_' + usuarioAtual);
                let extrato = extratoData ? JSON.parse(extratoData) : [];
                extrato.push(transacaoTeste);
                localStorage.setItem('adln_extrato_' + usuarioAtual, JSON.stringify(extrato));

                resultado.innerHTML = '<span class="success">‚úÖ Transa√ß√£o de teste criada com sucesso!</span>';
                resultado.innerHTML += '<br><span class="info">PETR4 - Compra de 100 lotes por R$ 28,50</span>';
                resultado.innerHTML += '<br><span class="info">Agora voc√™ pode testar a exporta√ß√£o!</span>';

            } catch (error) {
                resultado.innerHTML = '<span class="error">‚ùå Erro ao simular transa√ß√£o: ' + error.message + '</span>';
            }
        }

        // Teste autom√°tico ao carregar a p√°gina
        window.onload = function() {
            const resultado = document.getElementById('resultado-teste');
            resultado.innerHTML = `
                <h3>üîß Funcionalidade de Exporta√ß√£o Implementada:</h3>
                <ul>
                    <li class="success">‚úÖ Exporta√ß√£o JSON: Transa√ß√µes do dia em formato JSON</li>
                    <li class="success">‚úÖ Exporta√ß√£o Excel: Extrato completo em formato XLSX</li>
                    <li class="success">‚úÖ Menu integrado: Acesso via menu hamb√∫rguer</li>
                    <li class="success">‚úÖ Bot√£o dedicado: Exporta√ß√£o Excel na se√ß√£o de extrato</li>
                </ul>
                <p class="info">üí° Execute os testes acima para verificar o funcionamento.</p>
            `;
        };
    </script>
</body>
</html>
