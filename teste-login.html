<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Login - ADLN Broker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            white-space: pre-wrap;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
    </style>
</head>
<body>
    <h1>üîç Teste de Login - ADLN Broker</h1>
    
    <div class="test-section">
        <h2>1. Verificar localStorage</h2>
        <button class="test-button" onclick="verificarLocalStorage()">Verificar localStorage</button>
        <div id="localStorageResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. Criar usu√°rio de teste</h2>
        <button class="test-button" onclick="criarUsuarioTeste()">Criar usu√°rio de teste</button>
        <div id="criarUsuarioResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. Simular login</h2>
        <button class="test-button" onclick="simularLogin()">Simular login</button>
        <div id="loginResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>4. Testar fun√ß√£o isUserLoggedIn</h2>
        <button class="test-button" onclick="testarIsUserLoggedIn()">Testar isUserLoggedIn</button>
        <div id="isLoggedInResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>5. Testar carregarDados</h2>
        <button class="test-button" onclick="testarCarregarDados()">Testar carregarDados</button>
        <div id="carregarDadosResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>6. Limpar dados</h2>
        <button class="test-button" onclick="limparDados()">Limpar localStorage</button>
        <div id="limparResult" class="result"></div>
    </div>

    <script>
        // Fun√ß√£o para verificar localStorage
        function verificarLocalStorage() {
            const result = document.getElementById('localStorageResult');
            try {
                const usuarios = localStorage.getItem('adln_usuarios');
                const usuarioAtual = localStorage.getItem('adln_usuario_atual');
                
                let output = '=== localStorage Status ===\n';
                output += `Usu√°rios: ${usuarios ? 'Existe' : 'N√£o existe'}\n`;
                output += `Usu√°rio atual: ${usuarioAtual || 'Nenhum'}\n`;
                
                if (usuarios) {
                    const usuariosObj = JSON.parse(usuarios);
                    output += `N√∫mero de usu√°rios: ${Object.keys(usuariosObj).length}\n`;
                    output += `CPFs: ${Object.keys(usuariosObj).join(', ')}\n`;
                }
                
                result.textContent = output;
                result.className = 'result success';
            } catch (e) {
                result.textContent = `Erro: ${e.message}`;
                result.className = 'result error';
            }
        }

        // Fun√ß√£o para criar usu√°rio de teste
        function criarUsuarioTeste() {
            const result = document.getElementById('criarUsuarioResult');
            try {
                const cpfTeste = '442.442.442-42';
                const senhaTeste = 'Teste1234';
                
                // Carregar usu√°rios existentes
                let usuarios = {};
                const dadosUsuarios = localStorage.getItem('adln_usuarios');
                if (dadosUsuarios) {
                    usuarios = JSON.parse(dadosUsuarios);
                }
                
                // Criar usu√°rio de teste
                usuarios[cpfTeste] = {
                    nome: "Usu√°rio de Teste",
                    cpf: cpfTeste,
                    email: "teste@adlnbroker.com",
                    celular: "(11) 99999-9999",
                    senha: senhaTeste,
                    saldo: 100000,
                    dataCadastro: new Date().toISOString()
                };
                
                localStorage.setItem('adln_usuarios', JSON.stringify(usuarios));
                
                result.textContent = `‚úÖ Usu√°rio de teste criado com sucesso!\nCPF: ${cpfTeste}\nSenha: ${senhaTeste}`;
                result.className = 'result success';
            } catch (e) {
                result.textContent = `‚ùå Erro ao criar usu√°rio: ${e.message}`;
                result.className = 'result error';
            }
        }

        // Fun√ß√£o para simular login
        function simularLogin() {
            const result = document.getElementById('loginResult');
            try {
                const cpf = '442.442.442-42';
                const senha = 'Teste1234';
                
                // Carregar usu√°rios
                const usuarios = JSON.parse(localStorage.getItem('adln_usuarios')) || {};
                
                // Verificar usu√°rio
                if (!usuarios[cpf]) {
                    result.textContent = '‚ùå Usu√°rio n√£o encontrado';
                    result.className = 'result error';
                    return;
                }
                
                if (usuarios[cpf].senha !== senha) {
                    result.textContent = '‚ùå Senha incorreta';
                    result.className = 'result error';
                    return;
                }
                
                // Login bem-sucedido
                localStorage.setItem('adln_usuario_atual', cpf);
                
                result.textContent = `‚úÖ Login realizado com sucesso!\nUsu√°rio: ${usuarios[cpf].nome}\nCPF: ${cpf}`;
                result.className = 'result success';
            } catch (e) {
                result.textContent = `‚ùå Erro no login: ${e.message}`;
                result.className = 'result error';
            }
        }

        // Fun√ß√£o para testar isUserLoggedIn
        function testarIsUserLoggedIn() {
            const result = document.getElementById('isLoggedInResult');
            try {
                const usuarioAtual = localStorage.getItem('adln_usuario_atual');
                if (!usuarioAtual) {
                    result.textContent = '‚ùå Nenhum usu√°rio logado';
                    result.className = 'result error';
                    return;
                }

                const usuarios = JSON.parse(localStorage.getItem('adln_usuarios')) || {};
                const isLoggedIn = usuarios[usuarioAtual] !== undefined;
                
                if (isLoggedIn) {
                    result.textContent = `‚úÖ Usu√°rio logado: ${usuarioAtual}\nNome: ${usuarios[usuarioAtual].nome}`;
                    result.className = 'result success';
                } else {
                    result.textContent = `‚ùå Usu√°rio n√£o encontrado: ${usuarioAtual}`;
                    result.className = 'result error';
                }
            } catch (e) {
                result.textContent = `‚ùå Erro: ${e.message}`;
                result.className = 'result error';
            }
        }

        // Fun√ß√£o para testar carregarDados (simulada)
        function testarCarregarDados() {
            const result = document.getElementById('carregarDadosResult');
            try {
                // Simular a fun√ß√£o carregarDados do sistema.js
                const dadosUsuarios = localStorage.getItem("adln_usuarios");
                let usuarios = {};
                
                if (dadosUsuarios) {
                    usuarios = JSON.parse(dadosUsuarios);
                    
                    // Verificar se h√° remo√ß√£o do usu√°rio de teste
                    if (usuarios["442.442.442-42"]) {
                        result.textContent = `‚úÖ Usu√°rio de teste ainda existe\nCPFs: ${Object.keys(usuarios).join(', ')}`;
                        result.className = 'result success';
                    } else {
                        result.textContent = `‚ùå Usu√°rio de teste foi removido\nCPFs: ${Object.keys(usuarios).join(', ')}`;
                        result.className = 'result error';
                    }
                } else {
                    result.textContent = '‚ùå Nenhum usu√°rio encontrado no localStorage';
                    result.className = 'result error';
                }
            } catch (e) {
                result.textContent = `‚ùå Erro: ${e.message}`;
                result.className = 'result error';
            }
        }

        // Fun√ß√£o para limpar dados
        function limparDados() {
            const result = document.getElementById('limparResult');
            try {
                localStorage.removeItem('adln_usuarios');
                localStorage.removeItem('adln_usuario_atual');
                result.textContent = '‚úÖ localStorage limpo com sucesso';
                result.className = 'result success';
            } catch (e) {
                result.textContent = `‚ùå Erro ao limpar: ${e.message}`;
                result.className = 'result error';
            }
        }

        // Executar verifica√ß√£o inicial
        window.onload = function() {
            verificarLocalStorage();
        };
    </script>
</body>
</html>
